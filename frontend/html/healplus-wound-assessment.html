<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HealPlus - Avaliação de Ferida</title>
    <link rel="stylesheet" href="../css/healplus-design.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <div class="healplus-app">
        <!-- Header -->
        <header class="healplus-header">
            <div class="flex items-center gap-4">
                <button class="mobile-menu-toggle" id="mobileMenuToggle" style="display: none;">
                    <i class="fas fa-bars"></i>
                </button>
                <a href="healplus-dashboard.html" class="healplus-logo">
                    <div class="healplus-logo-icon">H+</div>
                    <span>HealPlus</span>
                </a>
            </div>
            
            <div class="flex items-center gap-4">
                <div class="flex items-center gap-3">
                    <div class="text-right">
                        <div class="font-semibold text-sm">João Silva</div>
                        <div class="text-xs text-gray-500">Paciente</div>
                    </div>
                    <div class="w-8 h-8 bg-primary-500 rounded-full flex items-center justify-center text-white text-sm font-semibold">
                        JS
                    </div>
                </div>
                <button class="btn btn-outline btn-sm" onclick="toggleTheme()">
                    <i class="fas fa-sun"></i>
                </button>
            </div>
        </header>

        <!-- Main Content -->
        <main class="healplus-main">
            <!-- Sidebar -->
            <aside class="healplus-sidebar" id="sidebar">
                <nav class="healplus-nav">
                    <div class="nav-section">
                        <div class="nav-section-title">Meu Portal</div>
                        <a href="healplus-dashboard.html" class="nav-item">
                            <i class="fas fa-chart-line nav-item-icon"></i>
                            Dashboard
                        </a>
                        <a href="#assessment" class="nav-item active">
                            <i class="fas fa-camera nav-item-icon"></i>
                            Avaliar Ferida
                        </a>
                        <a href="patient-appointments.html" class="nav-item">
                            <i class="fas fa-calendar nav-item-icon"></i>
                            Consultas
                        </a>
                        <a href="patient-telehealth.html" class="nav-item">
                            <i class="fas fa-video nav-item-icon"></i>
                            Teleconsulta
                        </a>
                    </div>
                    
                    <div class="nav-section">
                        <div class="nav-section-title">Monitoramento</div>
                        <a href="patient-daily-checkin.html" class="nav-item">
                            <i class="fas fa-heart nav-item-icon"></i>
                            Check-in Diário
                        </a>
                        <a href="patient-medications.html" class="nav-item">
                            <i class="fas fa-pills nav-item-icon"></i>
                            Medicamentos
                        </a>
                        <a href="patient-reports.html" class="nav-item">
                            <i class="fas fa-file-medical nav-item-icon"></i>
                            Relatórios
                        </a>
                    </div>
                    
                    <div class="nav-section">
                        <div class="nav-section-title">Conta</div>
                        <a href="patient-profile.html" class="nav-item">
                            <i class="fas fa-user nav-item-icon"></i>
                            Perfil
                        </a>
                        <a href="patient-settings.html" class="nav-item">
                            <i class="fas fa-cog nav-item-icon"></i>
                            Configurações
                        </a>
                        <a href="#" class="nav-item logout-btn">
                            <i class="fas fa-sign-out-alt nav-item-icon"></i>
                            Sair
                        </a>
                    </div>
                </nav>
            </aside>

            <!-- Content -->
            <div class="healplus-content">
                <!-- Header Section -->
                <div class="mb-8">
                    <div class="flex items-center justify-between">
                        <div>
                            <h1 class="text-2xl font-bold mb-2">Avaliação de Ferida</h1>
                            <p class="text-gray-600">Capture uma imagem e responda ao questionário para análise.</p>
                        </div>
                        <div class="flex items-center gap-2">
                            <span class="status-badge status-pending">Em Progresso</span>
                        </div>
                    </div>
                </div>

                <!-- Assessment Steps -->
                <div class="mb-8">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center gap-4">
                            <div class="flex items-center gap-2">
                                <div class="w-8 h-8 bg-primary-500 rounded-full flex items-center justify-center text-white text-sm font-semibold">1</div>
                                <span class="font-medium">Captura de Imagem</span>
                            </div>
                            <div class="w-8 h-0.5 bg-primary-200"></div>
                            <div class="flex items-center gap-2">
                                <div class="w-8 h-8 bg-gray-200 rounded-full flex items-center justify-center text-gray-600 text-sm font-semibold">2</div>
                                <span class="text-gray-600">Questionário</span>
                            </div>
                            <div class="w-8 h-0.5 bg-gray-200"></div>
                            <div class="flex items-center gap-2">
                                <div class="w-8 h-8 bg-gray-200 rounded-full flex items-center justify-center text-gray-600 text-sm font-semibold">3</div>
                                <span class="text-gray-600">Análise</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Main Assessment Form -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <!-- Image Capture Section -->
                    <div class="healplus-card">
                        <div class="card-header">
                            <h2 class="card-title">Captura de Imagem</h2>
                            <p class="card-subtitle">Tire uma foto clara da ferida</p>
                        </div>
                        
                        <div class="space-y-4">
                            <!-- Camera Preview -->
                            <div class="relative">
                                <div id="cameraPreview" class="w-full h-64 bg-gray-100 rounded-lg flex items-center justify-center border-2 border-dashed border-gray-300">
                                    <div class="text-center">
                                        <i class="fas fa-camera text-4xl text-gray-400 mb-4"></i>
                                        <p class="text-gray-600 mb-2">Clique para capturar a imagem</p>
                                        <p class="text-sm text-gray-500">Ou arraste uma imagem aqui</p>
                                    </div>
                                </div>
                                <input type="file" id="imageInput" accept="image/*" capture="environment" class="hidden">
                            </div>

                            <!-- Capture Controls -->
                            <div class="flex gap-3">
                                <button class="btn btn-primary flex-1" onclick="captureImage()">
                                    <i class="fas fa-camera"></i>
                                    Capturar Imagem
                                </button>
                                <button class="btn btn-outline" onclick="retakeImage()">
                                    <i class="fas fa-redo"></i>
                                    Refazer
                                </button>
                            </div>

                            <!-- Image Guidelines -->
                            <div class="p-4 bg-blue-50 rounded-lg">
                                <h3 class="font-medium text-blue-900 mb-2">Dicas para uma boa foto:</h3>
                                <ul class="text-sm text-blue-800 space-y-1">
                                    <li>• Use boa iluminação natural</li>
                                    <li>• Mantenha a câmera estável</li>
                                    <li>• Enquadre apenas a ferida</li>
                                    <li>• Evite sombras ou reflexos</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <!-- Assessment Form -->
                    <div class="healplus-card">
                        <div class="card-header">
                            <h2 class="card-title">Questionário de Avaliação</h2>
                            <p class="card-subtitle">Responda as perguntas sobre sua ferida</p>
                        </div>
                        
                        <form id="assessmentForm" class="space-y-6">
                            <!-- Pain Level -->
                            <div class="form-group">
                                <label class="form-label">Nível de Dor (0-10)</label>
                                <div class="space-y-2">
                                    <input type="range" id="painLevel" name="painLevel" min="0" max="10" value="0" class="w-full">
                                    <div class="flex justify-between text-sm text-gray-600">
                                        <span>0 - Sem dor</span>
                                        <span id="painValue" class="font-medium text-primary-600">0</span>
                                        <span>10 - Dor extrema</span>
                                    </div>
                                </div>
                            </div>

                            <!-- Wound Location -->
                            <div class="form-group">
                                <label class="form-label">Localização da Ferida</label>
                                <select name="woundLocation" class="form-select" required>
                                    <option value="">Selecione...</option>
                                    <option value="leg">Perna</option>
                                    <option value="arm">Braço</option>
                                    <option value="foot">Pé</option>
                                    <option value="hand">Mão</option>
                                    <option value="torso">Tronco</option>
                                    <option value="head">Cabeça</option>
                                    <option value="other">Outro</option>
                                </select>
                            </div>

                            <!-- Wound Size -->
                            <div class="form-group">
                                <label class="form-label">Tamanho Aproximado</label>
                                <div class="grid grid-cols-2 gap-3">
                                    <input type="number" name="woundLength" placeholder="Comprimento (cm)" class="form-input" step="0.1">
                                    <input type="number" name="woundWidth" placeholder="Largura (cm)" class="form-input" step="0.1">
                                </div>
                            </div>

                            <!-- Symptoms -->
                            <div class="form-group">
                                <label class="form-label">Sintomas (marque todos que se aplicam)</label>
                                <div class="space-y-2">
                                    <label class="flex items-center gap-3">
                                        <input type="checkbox" name="symptoms" value="redness" class="rounded">
                                        <span class="text-sm">Vermelhidão</span>
                                    </label>
                                    <label class="flex items-center gap-3">
                                        <input type="checkbox" name="symptoms" value="swelling" class="rounded">
                                        <span class="text-sm">Inchaço</span>
                                    </label>
                                    <label class="flex items-center gap-3">
                                        <input type="checkbox" name="symptoms" value="warmth" class="rounded">
                                        <span class="text-sm">Calor local</span>
                                    </label>
                                    <label class="flex items-center gap-3">
                                        <input type="checkbox" name="symptoms" value="discharge" class="rounded">
                                        <span class="text-sm">Secreção</span>
                                    </label>
                                    <label class="flex items-center gap-3">
                                        <input type="checkbox" name="symptoms" value="odor" class="rounded">
                                        <span class="text-sm">Odor</span>
                                    </label>
                                </div>
                            </div>

                            <!-- Wound Age -->
                            <div class="form-group">
                                <label class="form-label">Há quanto tempo tem esta ferida?</label>
                                <select name="woundAge" class="form-select" required>
                                    <option value="">Selecione...</option>
                                    <option value="less-than-week">Menos de 1 semana</option>
                                    <option value="1-2-weeks">1-2 semanas</option>
                                    <option value="2-4-weeks">2-4 semanas</option>
                                    <option value="1-3-months">1-3 meses</option>
                                    <option value="more-than-3-months">Mais de 3 meses</option>
                                </select>
                            </div>

                            <!-- Additional Notes -->
                            <div class="form-group">
                                <label class="form-label">Observações Adicionais</label>
                                <textarea name="additionalNotes" rows="3" class="form-textarea" placeholder="Descreva qualquer observação importante sobre a ferida..."></textarea>
                            </div>

                            <!-- Submit Button -->
                            <div class="pt-4">
                                <button type="submit" class="btn btn-primary w-full btn-lg">
                                    <i class="fas fa-paper-plane"></i>
                                    Enviar Avaliação
                                </button>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- Recent Assessments -->
                <div class="mt-8">
                    <div class="healplus-card">
                        <div class="card-header">
                            <h2 class="card-title">Avaliações Recentes</h2>
                            <button class="btn btn-outline btn-sm">Ver Todas</button>
                        </div>
                        
                        <div class="space-y-4">
                            <div class="flex items-center gap-4 p-4 bg-gray-50 rounded-lg">
                                <div class="w-12 h-12 bg-primary-100 rounded-lg flex items-center justify-center">
                                    <i class="fas fa-camera text-primary-600"></i>
                                </div>
                                <div class="flex-1">
                                    <p class="font-medium">Avaliação #001</p>
                                    <p class="text-sm text-gray-600">15 de Janeiro, 2024 - 14:30</p>
                                    <p class="text-sm text-gray-600">Perna direita - Dor: 3/10</p>
                                </div>
                                <div class="text-right">
                                    <span class="status-badge status-completed">Analisada</span>
                                    <p class="text-xs text-gray-600 mt-1">Dr. Maria Santos</p>
                                </div>
                            </div>

                            <div class="flex items-center gap-4 p-4 bg-gray-50 rounded-lg">
                                <div class="w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center">
                                    <i class="fas fa-camera text-green-600"></i>
                                </div>
                                <div class="flex-1">
                                    <p class="font-medium">Avaliação #002</p>
                                    <p class="text-sm text-gray-600">12 de Janeiro, 2024 - 10:15</p>
                                    <p class="text-sm text-gray-600">Pé esquerdo - Dor: 5/10</p>
                                </div>
                                <div class="text-right">
                                    <span class="status-badge status-completed">Analisada</span>
                                    <p class="text-xs text-gray-600 mt-1">Dr. Carlos Lima</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Scripts -->
    <script src="../js/theme-manager.js"></script>
    <script src="../js/button-handler.js"></script>
    <script src="../js/enhanced-buttons.js"></script>
    <script src="../js/main.js"></script>
    
    <script>
        // Funcionalidades específicas da avaliação de feridas
        document.addEventListener('DOMContentLoaded', function() {
            const painLevel = document.getElementById('painLevel');
            const painValue = document.getElementById('painValue');
            const assessmentForm = document.getElementById('assessmentForm');
            const imageInput = document.getElementById('imageInput');
            const cameraPreview = document.getElementById('cameraPreview');
            
            // Controle do nível de dor
            painLevel.addEventListener('input', function() {
                painValue.textContent = this.value;
            });
            
            // Submissão do formulário
            assessmentForm.addEventListener('submit', function(e) {
                e.preventDefault();
                
                const formData = new FormData(this);
                const assessmentData = {
                    id: generateAssessmentId(),
                    timestamp: new Date().toISOString(),
                    painLevel: formData.get('painLevel'),
                    woundLocation: formData.get('woundLocation'),
                    woundLength: formData.get('woundLength'),
                    woundWidth: formData.get('woundWidth'),
                    symptoms: formData.getAll('symptoms'),
                    woundAge: formData.get('woundAge'),
                    additionalNotes: formData.get('additionalNotes'),
                    image: getCapturedImage(),
                    status: 'pending'
                };
                
                // Salvar no localStorage
                const assessments = JSON.parse(localStorage.getItem('woundAssessments') || '[]');
                assessments.push(assessmentData);
                localStorage.setItem('woundAssessments', JSON.stringify(assessments));
                
                showNotification('Avaliação enviada com sucesso!', 'success');
                
                // Limpar formulário
                this.reset();
                painValue.textContent = '0';
                clearImage();
                
                // Simular análise
                setTimeout(() => {
                    showNotification('Análise concluída! Verifique seus relatórios.', 'info');
                }, 3000);
            });
            
            // Configurar captura de imagem
            imageInput.addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (file) {
                    displayImage(file);
                }
            });
            
            // Drag and drop
            cameraPreview.addEventListener('dragover', function(e) {
                e.preventDefault();
                this.classList.add('border-primary-400', 'bg-primary-50');
            });
            
            cameraPreview.addEventListener('dragleave', function(e) {
                e.preventDefault();
                this.classList.remove('border-primary-400', 'bg-primary-50');
            });
            
            cameraPreview.addEventListener('drop', function(e) {
                e.preventDefault();
                this.classList.remove('border-primary-400', 'bg-primary-50');
                
                const files = e.dataTransfer.files;
                if (files.length > 0) {
                    displayImage(files[0]);
                }
            });
            
            // Click para abrir seletor de arquivo
            cameraPreview.addEventListener('click', function() {
                imageInput.click();
            });
        });
        
        function captureImage() {
            // Simular captura de imagem
            showNotification('Abrindo câmera...', 'info');
            imageInput.click();
        }
        
        function displayImage(file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                const cameraPreview = document.getElementById('cameraPreview');
                cameraPreview.innerHTML = `
                    <img src="${e.target.result}" alt="Imagem da ferida" class="w-full h-full object-cover rounded-lg">
                `;
                cameraPreview.classList.remove('border-dashed');
                cameraPreview.classList.add('border-solid', 'border-primary-400');
            };
            reader.readAsDataURL(file);
        }
        
        function retakeImage() {
            clearImage();
            showNotification('Imagem removida. Capture uma nova imagem.', 'info');
        }
        
        function clearImage() {
            const cameraPreview = document.getElementById('cameraPreview');
            cameraPreview.innerHTML = `
                <div class="text-center">
                    <i class="fas fa-camera text-4xl text-gray-400 mb-4"></i>
                    <p class="text-gray-600 mb-2">Clique para capturar a imagem</p>
                    <p class="text-sm text-gray-500">Ou arraste uma imagem aqui</p>
                </div>
            `;
            cameraPreview.classList.remove('border-solid', 'border-primary-400');
            cameraPreview.classList.add('border-dashed');
        }
        
        function getCapturedImage() {
            const img = document.querySelector('#cameraPreview img');
            return img ? img.src : null;
        }
        
        function generateAssessmentId() {
            return 'ASSESS_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
        }
        
        function showNotification(message, type) {
            if (window.buttonHandler && window.buttonHandler.showNotification) {
                window.buttonHandler.showNotification(message, type);
            } else {
                alert(message);
            }
        }
        
        function toggleTheme() {
            document.body.classList.toggle('dark-theme');
            const isDark = document.body.classList.contains('dark-theme');
            localStorage.setItem('theme', isDark ? 'dark' : 'light');
        }
        
        // Aplicar tema salvo
        const savedTheme = localStorage.getItem('theme');
        if (savedTheme === 'dark') {
            document.body.classList.add('dark-theme');
        }
    </script>
</body>
</html>
