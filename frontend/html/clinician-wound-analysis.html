<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Heal+ - Análise de Feridas</title>
    <link rel="stylesheet" href="../css/modern-design.css">
    <link rel="stylesheet" href="../css/icons.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <a href="clinician-dashboard.html" class="logo">
                    <div class="logo-icon">H+</div>
                    <div class="logo-text">Heal+</div>
                </a>
            </div>
            
            <nav class="sidebar-nav">
                <div class="nav-section">
                    <div class="nav-section-title">Clínica</div>
                    <a href="clinician-dashboard.html" class="nav-item">
                        <span class="icon icon-chart"></span>
                        Dashboard
                    </a>
                    <a href="clinician-patients.html" class="nav-item">
                        <span class="icon icon-user-group"></span>
                        Meus Pacientes
                    </a>
                    <a href="clinician-appointments.html" class="nav-item">
                        <span class="icon icon-calendar"></span>
                        Agenda
                    </a>
                    <a href="clinician-telehealth.html" class="nav-item">
                        <span class="icon icon-video"></span>
                        Teleconsultas
                    </a>
                </div>
                
                <div class="nav-section">
                    <div class="nav-section-title">Análises</div>
                    <a href="#analysis" class="nav-item active">
                        <span class="icon icon-shield"></span>
                        Análise de Feridas
                    </a>
                    <a href="clinician-ai-insights.html" class="nav-item">
                        <span class="icon icon-brain"></span>
                        Insights de IA
                    </a>
                    <a href="clinician-reports.html" class="nav-item">
                        <span class="icon icon-document"></span>
                        Relatórios
                    </a>
                </div>
                
                <div class="nav-section">
                    <div class="nav-section-title">Administração</div>
                    <a href="clinician-profile.html" class="nav-item">
                        <span class="icon icon-user"></span>
                        Meu Perfil
                    </a>
                    <a href="clinician-settings.html" class="nav-item">
                        <span class="icon icon-settings"></span>
                        Configurações
                    </a>
                    <a href="#" class="nav-item logout-btn">
                        <span class="icon icon-logout"></span>
                        Sair
                    </a>
                </div>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Header -->
            <header class="header">
                <div class="header-left">
                    <button class="mobile-menu-toggle" id="mobileMenuToggle">
                        <span class="icon icon-menu"></span>
                    </button>
                    <h1 class="page-title">Análise de Feridas</h1>
                </div>
                
                <div class="header-right">
                    <div class="user-info">
                        <span class="user-name">Dr. Maria Santos</span>
                        <span class="user-role">Clínico</span>
                    </div>
                    <button class="theme-toggle" id="themeToggle">
                        <span class="icon icon-sun"></span>
                    </button>
                </div>
            </header>

            <!-- Analysis Content -->
            <div class="analysis-content">
                <!-- Pending Analysis -->
                <div class="pending-analysis">
                    <h2>Avaliações Pendentes</h2>
                    <div class="analysis-list" id="pendingAnalysisList">
                        <!-- Análises pendentes serão carregadas aqui -->
                    </div>
                </div>

                <!-- Analysis Tools -->
                <div class="analysis-tools" id="analysisTools" style="display: none;">
                    <div class="analysis-header">
                        <h3>Análise de Ferida</h3>
                        <div class="patient-info">
                            <span class="patient-name" id="currentPatientName">João Silva</span>
                            <span class="analysis-date" id="currentAnalysisDate">Enviada há 2 horas</span>
                        </div>
                    </div>
                    
                    <div class="analysis-workspace">
                        <div class="image-viewer">
                            <div class="image-container" id="imageContainer">
                                <img id="analysisImage" src="" alt="Imagem da ferida">
                                <div class="image-overlay">
                                    <div class="zoom-controls">
                                        <button class="btn btn-sm" id="zoomIn">+</button>
                                        <button class="btn btn-sm" id="zoomOut">-</button>
                                        <button class="btn btn-sm" id="resetZoom">Reset</button>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="image-gallery" id="imageGallery">
                                <!-- Miniaturas das imagens -->
                            </div>
                        </div>
                        
                        <div class="analysis-panel">
                            <div class="analysis-form">
                                <h4>Análise Clínica</h4>
                                
                                <div class="form-group">
                                    <label for="woundType">Tipo de Ferida</label>
                                    <select id="woundType" name="woundType">
                                        <option value="">Selecione...</option>
                                        <option value="acute">Aguda</option>
                                        <option value="chronic">Crônica</option>
                                        <option value="surgical">Cirúrgica</option>
                                        <option value="pressure">Pressão</option>
                                        <option value="diabetic">Diabética</option>
                                        <option value="venous">Venosa</option>
                                        <option value="arterial">Arterial</option>
                                    </select>
                                </div>
                                
                                <div class="form-group">
                                    <label for="woundStage">Estágio da Ferida</label>
                                    <select id="woundStage" name="woundStage">
                                        <option value="">Selecione...</option>
                                        <option value="stage1">Estágio 1</option>
                                        <option value="stage2">Estágio 2</option>
                                        <option value="stage3">Estágio 3</option>
                                        <option value="stage4">Estágio 4</option>
                                        <option value="unstageable">Não classificável</option>
                                    </select>
                                </div>
                                
                                <div class="form-group">
                                    <label for="woundSize">Tamanho (cm)</label>
                                    <div class="size-inputs">
                                        <input type="number" id="woundLength" name="woundLength" placeholder="Comprimento" step="0.1">
                                        <input type="number" id="woundWidth" name="woundWidth" placeholder="Largura" step="0.1">
                                        <input type="number" id="woundDepth" name="woundDepth" placeholder="Profundidade" step="0.1">
                                    </div>
                                </div>
                                
                                <div class="form-group">
                                    <label for="woundColor">Cor da Ferida</label>
                                    <div class="color-options">
                                        <label class="color-option">
                                            <input type="radio" name="woundColor" value="red">
                                            <span class="color-sample red"></span>
                                            <span>Vermelho</span>
                                        </label>
                                        <label class="color-option">
                                            <input type="radio" name="woundColor" value="yellow">
                                            <span class="color-sample yellow"></span>
                                            <span>Amarelo</span>
                                        </label>
                                        <label class="color-option">
                                            <input type="radio" name="woundColor" value="black">
                                            <span class="color-sample black"></span>
                                            <span>Preto</span>
                                        </label>
                                        <label class="color-option">
                                            <input type="radio" name="woundColor" value="mixed">
                                            <span class="color-sample mixed"></span>
                                            <span>Misto</span>
                                        </label>
                                    </div>
                                </div>
                                
                                <div class="form-group">
                                    <label for="drainage">Drenagem</label>
                                    <select id="drainage" name="drainage">
                                        <option value="">Selecione...</option>
                                        <option value="none">Nenhuma</option>
                                        <option value="minimal">Mínima</option>
                                        <option value="moderate">Moderada</option>
                                        <option value="heavy">Abundante</option>
                                    </select>
                                </div>
                                
                                <div class="form-group">
                                    <label for="drainageType">Tipo de Drenagem</label>
                                    <select id="drainageType" name="drainageType">
                                        <option value="">Selecione...</option>
                                        <option value="serous">Serosa</option>
                                        <option value="serosanguineous">Serossanguinolenta</option>
                                        <option value="sanguineous">Sanguinolenta</option>
                                        <option value="purulent">Purulenta</option>
                                    </select>
                                </div>
                                
                                <div class="form-group">
                                    <label for="odor">Odor</label>
                                    <select id="odor" name="odor">
                                        <option value="">Selecione...</option>
                                        <option value="none">Nenhum</option>
                                        <option value="mild">Leve</option>
                                        <option value="moderate">Moderado</option>
                                        <option value="strong">Forte</option>
                                    </select>
                                </div>
                                
                                <div class="form-group">
                                    <label for="painLevel">Nível de Dor (0-10)</label>
                                    <input type="range" id="painLevel" name="painLevel" min="0" max="10" value="0">
                                    <div class="range-labels">
                                        <span>0 - Sem dor</span>
                                        <span>10 - Dor extrema</span>
                                    </div>
                                    <div class="pain-value">Dor: <span id="painValue">0</span></div>
                                </div>
                                
                                <div class="form-group">
                                    <label for="treatmentPlan">Plano de Tratamento</label>
                                    <textarea id="treatmentPlan" name="treatmentPlan" rows="4" placeholder="Descreva o plano de tratamento recomendado..."></textarea>
                                </div>
                                
                                <div class="form-group">
                                    <label for="medications">Medicamentos Prescritos</label>
                                    <textarea id="medications" name="medications" rows="3" placeholder="Liste os medicamentos prescritos..."></textarea>
                                </div>
                                
                                <div class="form-group">
                                    <label for="followUp">Próximo Acompanhamento</label>
                                    <input type="date" id="followUp" name="followUp">
                                </div>
                                
                                <div class="form-actions">
                                    <button type="button" class="btn btn-secondary" id="saveDraft">
                                        Salvar Rascunho
                                    </button>
                                    <button type="button" class="btn btn-primary" id="completeAnalysis">
                                        Concluir Análise
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Chat Support -->
    <div class="chat-support">
        <button class="chat-btn" id="chatBtn">
            <span class="icon icon-chat"></span>
        </button>
    </div>

    <!-- Scripts -->
    <script src="../js/theme-manager.js"></script>
    <script src="../js/button-handler.js"></script>
    <script src="../js/enhanced-buttons.js"></script>
    <script src="../js/main.js"></script>
    
    <script>
        // Funcionalidades específicas da análise de feridas
        document.addEventListener('DOMContentLoaded', function() {
            const pendingAnalysisList = document.getElementById('pendingAnalysisList');
            const analysisTools = document.getElementById('analysisTools');
            const currentPatientName = document.getElementById('currentPatientName');
            const currentAnalysisDate = document.getElementById('currentAnalysisDate');
            const analysisImage = document.getElementById('analysisImage');
            const imageGallery = document.getElementById('imageGallery');
            const painLevel = document.getElementById('painLevel');
            const painValue = document.getElementById('painValue');
            const saveDraftBtn = document.getElementById('saveDraft');
            const completeAnalysisBtn = document.getElementById('completeAnalysis');
            
            let currentAnalysis = null;
            let zoomLevel = 1;
            
            // Controle do nível de dor
            painLevel.addEventListener('input', function() {
                painValue.textContent = this.value;
            });
            
            // Carregar análises pendentes
            loadPendingAnalysis();
            
            function loadPendingAnalysis() {
                // Simular dados de análises pendentes
                const pendingAnalysis = [
                    {
                        id: 1,
                        patientName: 'João Silva',
                        patientId: 'JS001',
                        date: '2024-01-15T10:30:00Z',
                        type: 'Ferida no pé',
                        images: ['data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD...'],
                        symptoms: ['redness', 'swelling'],
                        painLevel: 6,
                        status: 'pending'
                    },
                    {
                        id: 2,
                        patientName: 'Ana Santos',
                        patientId: 'AS002',
                        date: '2024-01-15T09:15:00Z',
                        type: 'Ferida no braço',
                        images: ['data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD...'],
                        symptoms: ['discharge'],
                        painLevel: 4,
                        status: 'pending'
                    }
                ];
                
                pendingAnalysisList.innerHTML = '';
                
                pendingAnalysis.forEach(analysis => {
                    const analysisItem = document.createElement('div');
                    analysisItem.className = 'analysis-item';
                    analysisItem.innerHTML = `
                        <div class="analysis-image">
                            <img src="${analysis.images[0]}" alt="Imagem da ferida">
                        </div>
                        <div class="analysis-info">
                            <div class="analysis-patient">${analysis.patientName}</div>
                            <div class="analysis-type">${analysis.type}</div>
                            <div class="analysis-date">Enviada ${formatDate(analysis.date)}</div>
                            <div class="analysis-symptoms">
                                Sintomas: ${analysis.symptoms.join(', ')}
                            </div>
                        </div>
                        <div class="analysis-actions">
                            <button class="btn btn-primary" onclick="startAnalysis(${analysis.id})">
                                Analisar
                            </button>
                        </div>
                    `;
                    pendingAnalysisList.appendChild(analysisItem);
                });
            }
            
            function startAnalysis(analysisId) {
                // Simular carregamento da análise
                currentAnalysis = {
                    id: analysisId,
                    patientName: 'João Silva',
                    date: '2024-01-15T10:30:00Z',
                    images: ['data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD...']
                };
                
                currentPatientName.textContent = currentAnalysis.patientName;
                currentAnalysisDate.textContent = `Enviada ${formatDate(currentAnalysis.date)}`;
                analysisImage.src = currentAnalysis.images[0];
                
                // Mostrar ferramentas de análise
                analysisTools.style.display = 'block';
                
                // Carregar galeria de imagens
                loadImageGallery(currentAnalysis.images);
                
                // Scroll para as ferramentas
                analysisTools.scrollIntoView({ behavior: 'smooth' });
            }
            
            function loadImageGallery(images) {
                imageGallery.innerHTML = '';
                
                images.forEach((image, index) => {
                    const thumbnail = document.createElement('div');
                    thumbnail.className = 'image-thumbnail';
                    thumbnail.innerHTML = `<img src="${image}" alt="Imagem ${index + 1}">`;
                    thumbnail.addEventListener('click', () => {
                        analysisImage.src = image;
                    });
                    imageGallery.appendChild(thumbnail);
                });
            }
            
            function formatDate(dateString) {
                const date = new Date(dateString);
                const now = new Date();
                const diff = now - date;
                const hours = Math.floor(diff / (1000 * 60 * 60));
                
                if (hours < 1) {
                    return 'há poucos minutos';
                } else if (hours < 24) {
                    return `há ${hours} hora${hours > 1 ? 's' : ''}`;
                } else {
                    const days = Math.floor(hours / 24);
                    return `há ${days} dia${days > 1 ? 's' : ''}`;
                }
            }
            
            // Salvar rascunho
            saveDraftBtn.addEventListener('click', function() {
                const analysisData = collectAnalysisData();
                analysisData.status = 'draft';
                
                // Salvar no localStorage
                const drafts = JSON.parse(localStorage.getItem('analysisDrafts') || '[]');
                drafts.push(analysisData);
                localStorage.setItem('analysisDrafts', JSON.stringify(drafts));
                
                showNotification('Rascunho salvo com sucesso!', 'success');
            });
            
            // Concluir análise
            completeAnalysisBtn.addEventListener('click', function() {
                const analysisData = collectAnalysisData();
                analysisData.status = 'completed';
                analysisData.completedAt = new Date().toISOString();
                
                // Salvar no localStorage
                const completedAnalysis = JSON.parse(localStorage.getItem('completedAnalysis') || '[]');
                completedAnalysis.push(analysisData);
                localStorage.setItem('completedAnalysis', JSON.stringify(completedAnalysis));
                
                showNotification('Análise concluída com sucesso!', 'success');
                
                // Recarregar lista de pendentes
                setTimeout(() => {
                    loadPendingAnalysis();
                    analysisTools.style.display = 'none';
                }, 2000);
            });
            
            function collectAnalysisData() {
                return {
                    id: currentAnalysis.id,
                    patientName: currentAnalysis.patientName,
                    woundType: document.getElementById('woundType').value,
                    woundStage: document.getElementById('woundStage').value,
                    woundLength: document.getElementById('woundLength').value,
                    woundWidth: document.getElementById('woundWidth').value,
                    woundDepth: document.getElementById('woundDepth').value,
                    woundColor: document.querySelector('input[name="woundColor"]:checked')?.value,
                    drainage: document.getElementById('drainage').value,
                    drainageType: document.getElementById('drainageType').value,
                    odor: document.getElementById('odor').value,
                    painLevel: document.getElementById('painLevel').value,
                    treatmentPlan: document.getElementById('treatmentPlan').value,
                    medications: document.getElementById('medications').value,
                    followUp: document.getElementById('followUp').value,
                    analyzedAt: new Date().toISOString()
                };
            }
        });
        
        // Função global para iniciar análise
        function startAnalysis(analysisId) {
            // Esta função será chamada pelos botões de análise
            window.dispatchEvent(new CustomEvent('startAnalysis', { detail: { analysisId } }));
        }
        
        function showNotification(message, type) {
            if (window.buttonHandler && window.buttonHandler.showNotification) {
                window.buttonHandler.showNotification(message, type);
            } else {
                alert(message);
            }
        }
    </script>
</body>
</html>
